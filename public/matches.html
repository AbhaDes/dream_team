<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matches - Dream Team</title>
  <meta name="description" content="Find your perfect teammates">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-background">
  <!-- Sidebar -->
  <aside class="sidebar">
    <a href="index.html" class="sidebar-logo">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" style="color: var(--lime);">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
      </svg>
      <span class="text-foreground font-bold text-lg">Dream Team</span>
    </a>
    <nav class="sidebar-nav">
      <a href="matches.html" class="sidebar-link active">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        Matches
      </a>
      <a href="connections.html" class="sidebar-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        Connections
      </a>
      <a href="settings.html" class="sidebar-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
        Settings
      </a>
    </nav>
  </aside>
  <!-- Main Content -->
  <main class="main-with-sidebar">
    <div class="max-w-5xl mx-auto">

      <!-- Title -->
      <h1 class="text-4xl font-extrabold" style="margin-bottom: 0.5rem;">
        <span class="text-foreground">People </span>
        <span class="gradient-text-violet-blue italic">You Might Click With</span>
      </h1>

      <!-- Subtitle with ID -->
      <p id="matchCount" class="text-muted-foreground" style="margin-bottom: 1.5rem;">Loading matches...</p>

      <!-- Filter Tabs -->
      <div class="filter-tabs">
        <button class="filter-tab active">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          Explore All
        </button>
      </div>

      <!-- Match Cards Grid -->
      <div class="match-grid">
        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
          <p class="text-muted-foreground">Loading your matches...</p>
        </div>
      </div>
    </div>
  </main>
<script>
  window.addEventListener('DOMContentLoaded', async () => {
      const eventId = 'b2e50473-9793-4d45-87a1-23835f1e3bb8'; 
      
      try {
          // Fetch matches
          const response = await fetch(`/api/events/${eventId}/matches`, {
              credentials: 'include'
          });
          
          if (!response.ok) {
              throw new Error('Failed to fetch matches');
          }
          
          const data = await response.json();
          const matches = data.matches;
          
          // Update subtitle with count using ID
          document.getElementById('matchCount').textContent = 
              `${matches.length} potential teammate${matches.length !== 1 ? 's' : ''} waiting for you`;
          
          // Get container and clear existing cards
          const matchGrid = document.querySelector('.match-grid');
          matchGrid.innerHTML = '';
          
          // Check if no matches
          if (matches.length === 0) {
              matchGrid.innerHTML = `
                  <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                      <p class="text-muted-foreground">No matches found. Check back later!</p>
                  </div>
              `;
              return;
          }
          
          // Create card for each match
          matches.forEach(match => {
              const card = document.createElement('div');
              card.className = 'match-card';
              
              // Format skills
              const skillsHTML = match.skills && match.skills.length > 0 
                  ? match.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')
                  : '<span class="skill-tag">No skills listed</span>';
              
              card.innerHTML = `
                  <div class="match-header">
                      <div class="match-avatar">
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                              <circle cx="9" cy="7" r="4"></circle>
                              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                          </svg>
                      </div>
                      <div class="match-info">
                          <h3 class="text-foreground">${match.username || 'Anonymous'}</h3>
                          <p>${match.role || 'No role specified'}</p>
                          <span>${match.experience || 'Experience not specified'} ‚Ä¢ ${match.availability || 'Availability not specified'}</span>
                      </div>
                  </div>

                  <div class="why-click">
                      <div class="why-click-label">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <line x1="9" y1="18" x2="15" y2="18"></line>
                              <line x1="10" y1="22" x2="14" y2="22"></line>
                              <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"></path>
                          </svg>
                          COMPATIBILITY SCORE
                      </div>
                      <span class="why-click-badge complement">${match.compatibility_score}/100</span>
                  </div>

                  <p class="match-bio">${match.bio || 'No bio provided.'}</p>

                  <div class="skills-section">
                      <div class="skills-label text-lime">
                          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M12 3l1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3z"></path>
                          </svg>
                          SKILLS THEY HAVE
                      </div>
                      <div class="skills-list">
                          ${skillsHTML}
                      </div>
                  </div>

                  <div style="flex: 1;"></div>

                  <div class="match-actions">
                      <button class="btn btn-card flex-1" onclick="passMatch(event, '${match.participant_id}')">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <line x1="18" y1="6" x2="6" y2="18"></line>
                              <line x1="6" y1="6" x2="18" y2="18"></line>
                          </svg>
                          Pass
                      </button>
                      <button class="btn btn-gradient flex-1" onclick="likeMatch(event, '${match.participant_id}')">Explore Collaboration</button>
                  </div>
              `;
              
              matchGrid.appendChild(card);
          });
          
      } catch (error) {
          console.error('Error loading matches:', error);
          document.querySelector('.match-grid').innerHTML = `
              <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                  <p class="text-muted-foreground">Error loading matches. Please try again later.</p>
              </div>
          `;
      }
  });

  async function likeMatch(event, participantId) {
    const eventId = 'b2e50473-9793-4d45-87a1-23835f1e3bb8';
    
    try {
        const response = await fetch(`/api/events/${eventId}/like`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
                participant_id: participantId
            })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            alert(data.error || 'Failed to like participant');
            return;
        }
        
        if (data.message && data.message.includes('matched')) {
            alert('üéâ It\'s a Match! You can now collaborate!');
        } else {
            alert('üëç Like sent! Waiting for them to like you back.');
        }
        
        event.target.disabled = true;
        event.target.textContent = 'Like Sent!';
        
    } catch (error) {
        console.error('Error liking participant:', error);
        alert('Error sending like. Please try again.');
    }
  }

  function passMatch(event, participantId) {
    if (confirm('Pass on this match?')) {
        event.target.closest('.match-card').remove();
    }
  } 
</script>
</body>
</html>